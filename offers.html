<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Offers - OfferHub</title>
    <meta name="description" content="Browse all amazing local deals, discounts, and offers from shops near you. Support local businesses while saving money with OfferHub.">
    <meta name="keywords" content="local deals, discounts, offers, shopping, local business, save money">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    
    <link rel="stylesheet" href="css/style.css">
    
    <!-- Non-critical CSS -->
</head>
<body>
    <!-- Skip link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo">
                    <i class="fas fa-tags" aria-hidden="true"></i>
                    OfferHub
                </a>
                <nav aria-label="Main navigation">
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="offers.html" class="active">Offers</a></li>
                        <li><a href="shops.html">Shops</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </nav>
                <div class="auth-buttons">
                    <button class="btn btn-outline" onclick="window.location.href='login.html'">Log In</button>
                    <button class="btn btn-primary" onclick="window.location.href='login.html?action=signup'">Sign Up</button>
                </div>
            </div>
        </div>
    </header>

    <main id="main-content">
        <!-- Offers Header -->
        <section class="offers-header" aria-labelledby="offers-heading">
            <div class="container">
                <div class="hero-content">
                    <h1 id="offers-heading">All Offers Around You</h1>
                    <p>Browse trending discounts and shop nearby</p>
                    
                    <!-- Filters and Search -->
                    <div class="filters-section">
                        <div class="filter-group">
                            <select id="cityFilter" class="filter-select">
                                <option value="">Select City</option>
                                <option value="kalaburagi" selected>Kalaburagi</option>
                                <option value="bangalore">Bangalore</option>
                                <option value="hyderabad">Hyderabad</option>
                            </select>
                            
                            <select id="sortFilter" class="filter-select">
                                <option value="">Sort by: Latest</option>
                                <option value="popular">Most Popular</option>
                                <option value="discount">Highest Discount</option>
                                <option value="distance">Nearest</option>
                            </select>
                        </div>
                        
                        <div class="search-filter">
                            <input type="text" id="offerSearch" placeholder="Search offers...">
                            <button><i class="fas fa-search"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Offers Section -->
        <section class="section-padding" aria-labelledby="all-offers-heading">
            <div class="container">
                <div class="section-title">
                    <h2 id="all-offers-heading">All Available Offers</h2>
                    <p>Discover amazing deals from local vendors in your area</p>
                </div>
                
                <!-- Category Filter -->
                <div class="category-filter text-center">
                    <h3 class="h5 mb-3">Filter by Category:</h3>
                    <div role="group" aria-label="Filter deals by category">
                        <button class="btn filter-btn active" data-category="all">All Categories</button>
                        <button class="btn filter-btn" data-category="food">Food & Dining</button>
                        <button class="btn filter-btn" data-category="fashion">Fashion & Clothing</button>
                        <button class="btn filter-btn" data-category="electronics">Electronics</button>
                        <button class="btn filter-btn" data-category="books">Books & Education</button>
                        <button class="btn filter-btn" data-category="beverages">Beverages</button>
                        <button class="btn filter-btn" data-category="health">Health & Beauty</button>
                    </div>
                </div>

                <!-- Loading Spinner -->
                <div class="loading-spinner" id="loadingSpinner">
                    <div class="spinner" aria-label="Loading offers"></div>
                    <p class="mt-2">Loading offers...</p>
                </div>

                <!-- Offers Grid -->
                <div class="row" id="allOffersGrid" aria-live="polite">
                    <!-- Offers will be loaded here by JavaScript -->
                </div>

                <!-- Pagination -->
                <div class="pagination">
                    <button class="pagination-btn" id="prevBtn" disabled>
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    
                    <div class="pagination-numbers" id="paginationNumbers">
                        <!-- Page numbers will be generated by JavaScript -->
                    </div>
                    
                    <button class="pagination-btn" id="nextBtn">
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>OfferHub</h3>
                    <p>Free offers and shop locally with over 10,000 stores nationwide.</p>
                    <div class="social-icons">
                        <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f" aria-hidden="true"></i></a>
                        <a href="#" aria-label="Twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
                        <a href="#" aria-label="Instagram"><i class="fab fa-instagram" aria-hidden="true"></i></a>
                        <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin-in" aria-hidden="true"></i></a>
                    </div>
                </div>
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="offers.html">Offers</a></li>
                        <li><a href="shops.html">Shops</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Support</h3>
                    <ul>
                        <li><a href="#">Help Center</a></li>
                        <li><a href="contact.html">Contact Us</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Contact</h3>
                    <ul>
                        <li><i class="fas fa-envelope" aria-hidden="true"></i> support@offerhub.com</li>
                        <li><i class="fas fa-phone" aria-hidden="true"></i> +91 98765 43210</li>
                        <li><i class="fas fa-map-marker-alt" aria-hidden="true"></i> Kalaburagi, Karnataka, India</li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 OfferHub. All rights reserved.</p>
            </div>
        </div>
    </footer>
    
    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <!-- Add to all pages -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase.js"></script>
    <script src="js/offers.js"></script>

    <!-- Offers Page Specific JavaScript -->
    <script>
        // Toast Container
        const toastContainer = document.createElement('div');
        toastContainer.className = 'toast-container';
        toastContainer.id = 'toastContainer';
        document.body.appendChild(toastContainer);

        // Global variables for offers page
        let allOffers = [];
        let filteredOffers = [];
        let currentPage = 1;
        const offersPerPage = 9;
        let currentCategory = 'all';
        let currentSort = '';
        let currentCity = 'kalaburagi';
        let searchTimeout;

        // DOM elements
        const offersGrid = document.getElementById('allOffersGrid');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const paginationNumbers = document.getElementById('paginationNumbers');
        const cityFilter = document.getElementById('cityFilter');
        const sortFilter = document.getElementById('sortFilter');
        const offerSearch = document.getElementById('offerSearch');
        const searchBtn = document.querySelector('.search-filter button');

        // Initialize the offers page
        document.addEventListener('DOMContentLoaded', function() {
            loadAllOffers();
            initializeEventListeners();
            checkAuthStatus();
        });

        // Load all offers from Supabase
        async function loadAllOffers() {
            showLoading();
            // Show skeleton loading
            showSkeletonLoading();
            
            try {
                const offers = await loadOffersFromSupabase();
                allOffers = offers;
                filteredOffers = offers;
                displayOffers();
                updatePagination();
                hideLoading();
            } catch (error) {
                console.error('Error loading offers:', error);
                showToast('Failed to load offers. Please try again.', 'danger');
                hideLoading();
            }
        }

        // Show skeleton loading
        function showSkeletonLoading() {
            offersGrid.innerHTML = '';
            for (let i = 0; i < offersPerPage; i++) {
                const colDiv = document.createElement('div');
                colDiv.className = 'col-lg-4 col-md-6 mb-4';
                colDiv.innerHTML = `
                    <div class="offer-card">
                        <div class="offer-image skeleton skeleton-height-200"></div>
                        <div class="offer-content">
                            <div class="skeleton skeleton-height-20 skeleton-width-60 skeleton-mb-10"></div>
                            <div class="skeleton skeleton-height-24 skeleton-width-90 skeleton-mb-15"></div>
                            <div class="skeleton skeleton-height-30 skeleton-width-80 skeleton-mb-15"></div>
                            <div class="skeleton skeleton-height-16 skeleton-width-100 skeleton-mb-8"></div>
                            <div class="skeleton skeleton-height-16 skeleton-width-100 skeleton-mb-8"></div>
                            <div class="skeleton skeleton-height-16 skeleton-width-70 skeleton-mb-15"></div>
                            <div class="skeleton skeleton-height-40 skeleton-width-100"></div>
                        </div>
                    </div>
                `;
                offersGrid.appendChild(colDiv);
            }
        }

        // Load offers from Supabase
        async function loadOffersFromSupabase() {
            try {
                const connectionTest = await window.supabaseClient.testConnection();
                if (!connectionTest) {
                    console.log('Supabase connection failed, using demo data');
                    return getDemoOffers();
                }
                
                const { data, error } = await window.supabaseClient.data.getOffers();
                
                if (error || !data || data.length === 0) {
                    console.log('No offers found in database, using demo data');
                    return getDemoOffers();
                }
                
                // Transform the data for display
                const transformedOffers = data.map(offer => ({
                    id: offer.id,
                    shopName: offer.shops?.name || 'Local Shop',
                    item: offer.title || 'Special Offer',
                    originalPrice: Math.floor(Math.random() * 1000) + 200,
                    discountedPrice: Math.floor(Math.random() * 500) + 100,
                    discount: Math.floor(Math.random() * 50) + 10,
                    category: offer.category || 'general',
                    address: offer.shops?.location || 'Kalaburagi',
                    phone: '+91 98765 43210',
                    validUntil: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    description: offer.description || 'Great deal available now!',
                    image: offer.image_url || 'https://via.placeholder.com/400x250/2563eb/ffffff?text=Special+Offer',
                    rating: 4.0 + Math.random(),
                    reviews: Math.floor(Math.random() * 100) + 20
                }));
                
                return transformedOffers;
                
            } catch (error) {
                console.error('Error loading offers:', error);
                return getDemoOffers();
            }
        }

        // Demo offers fallback
        function getDemoOffers() {
            return [
                {
                    id: 1,
                    shopName: "Fashion Street",
                    item: "Summer Collection Discount",
                    originalPrice: 999,
                    discountedPrice: 599,
                    discount: 40,
                    category: "fashion",
                    address: "Kalaburagi Main Road",
                    phone: "+91 98765 43210",
                    validUntil: "2024-02-20",
                    description: "Latest fashion trends with amazing discounts",
                    image: "https://via.placeholder.com/400x250/2563eb/ffffff?text=Fashion+Street",
                    rating: 4.5,
                    reviews: 128
                },
                {
                    id: 2,
                    shopName: "Food Paradise",
                    item: "Delicious Meal Combo",
                    originalPrice: 450,
                    discountedPrice: 299,
                    discount: 34,
                    category: "food",
                    address: "Near College Campus",
                    phone: "+91 98765 43211",
                    validUntil: "2024-02-25",
                    description: "Tasty food with great ambiance",
                    image: "https://via.placeholder.com/400x250/f97316/ffffff?text=Food+Paradise",
                    rating: 4.3,
                    reviews: 89
                },
                {
                    id: 3,
                    shopName: "Tech World",
                    item: "Smartphone Discount",
                    originalPrice: 15999,
                    discountedPrice: 12999,
                    discount: 19,
                    category: "electronics",
                    address: "City Center Mall",
                    phone: "+91 98765 43212",
                    validUntil: "2024-02-28",
                    description: "Latest smartphones at discounted prices",
                    image: "https://via.placeholder.com/400x250/8b5cf6/ffffff?text=Tech+World",
                    rating: 4.7,
                    reviews: 215
                },
                {
                    id: 4,
                    shopName: "Book Haven",
                    item: "Educational Books Sale",
                    originalPrice: 1200,
                    discountedPrice: 799,
                    discount: 33,
                    category: "books",
                    address: "University Road",
                    phone: "+91 98765 43213",
                    validUntil: "2024-03-05",
                    description: "Wide collection of educational books",
                    image: "https://via.placeholder.com/400x250/10b981/ffffff?text=Book+Haven",
                    rating: 4.4,
                    reviews: 76
                },
                {
                    id: 5,
                    shopName: "Beverage Corner",
                    item: "Buy 1 Get 1 Free",
                    originalPrice: 200,
                    discountedPrice: 100,
                    discount: 50,
                    category: "beverages",
                    address: "Station Road",
                    phone: "+91 98765 43214",
                    validUntil: "2024-02-22",
                    description: "Refreshing beverages at great prices",
                    image: "https://via.placeholder.com/400x250/f59e0b/ffffff?text=Beverage+Corner",
                    rating: 4.2,
                    reviews: 142
                },
                {
                    id: 6,
                    shopName: "Beauty Palace",
                    item: "Skincare Products Discount",
                    originalPrice: 1500,
                    discountedPrice: 999,
                    discount: 33,
                    category: "health",
                    address: "Shopping Complex",
                    phone: "+91 98765 43215",
                    validUntil: "2024-03-01",
                    description: "Premium skincare products at discounted rates",
                    image: "https://via.placeholder.com/400x250/ec4899/ffffff?text=Beauty+Palace",
                    rating: 4.6,
                    reviews: 98
                },
                {
                    id: 7,
                    shopName: "Gadget Hub",
                    item: "Laptop Clearance Sale",
                    originalPrice: 45000,
                    discountedPrice: 35999,
                    discount: 20,
                    category: "electronics",
                    address: "Tech Park",
                    phone: "+91 98765 43216",
                    validUntil: "2024-02-18",
                    description: "High-performance laptops at clearance prices",
                    image: "https://via.placeholder.com/400x250/3b82f6/ffffff?text=Gadget+Hub",
                    rating: 4.8,
                    reviews: 312
                },
                {
                    id: 8,
                    shopName: "Fitness First",
                    item: "Gym Membership Offer",
                    originalPrice: 3000,
                    discountedPrice: 1999,
                    discount: 33,
                    category: "health",
                    address: "Sports Complex",
                    phone: "+91 98765 43217",
                    validUntil: "2024-03-10",
                    description: "Premium gym facilities at discounted rates",
                    image: "https://via.placeholder.com/400x250/10b981/ffffff?text=Fitness+First",
                    rating: 4.4,
                    reviews: 167
                },
                {
                    id: 9,
                    shopName: "Cafe Delight",
                    item: "Coffee & Pastry Combo",
                    originalPrice: 350,
                    discountedPrice: 249,
                    discount: 29,
                    category: "food",
                    address: "MG Road",
                    phone: "+91 98765 43218",
                    validUntil: "2024-02-24",
                    description: "Delicious coffee and pastries at special prices",
                    image: "https://via.placeholder.com/400x250/f97316/ffffff?text=Cafe+Delight",
                    rating: 4.5,
                    reviews: 203
                },
                {
                    id: 10,
                    shopName: "Style Studio",
                    item: "Men's Formal Wear",
                    originalPrice: 2500,
                    discountedPrice: 1799,
                    discount: 28,
                    category: "fashion",
                    address: "Fashion Street",
                    phone: "+91 98765 43219",
                    validUntil: "2024-02-26",
                    description: "Premium formal wear for men at discounted prices",
                    image: "https://via.placeholder.com/400x250/8b5cf6/ffffff?text=Style+Studio",
                    rating: 4.3,
                    reviews: 94
                }
            ];
        }

        // Display offers with pagination
        function displayOffers() {
            offersGrid.innerHTML = '';
            
            const startIndex = (currentPage - 1) * offersPerPage;
            const endIndex = startIndex + offersPerPage;
            const offersToShow = filteredOffers.slice(startIndex, endIndex);
            
            if (offersToShow.length === 0) {
                offersGrid.innerHTML = `
                    <div class="col-12 text-center">
                        <div class="alert alert-info alert-rounded">
                            <i class="fas fa-search fa-2x mb-3 d-block"></i>
                            <h5>No offers found</h5>
                            <p>Try adjusting your filters or search terms.</p>
                            <button class="btn btn-primary mt-2" onclick="resetFilters()">Reset Filters</button>
                        </div>
                    </div>
                `;
                return;
            }
            
            offersToShow.forEach(offer => {
                const offerCard = createOfferCard(offer);
                offersGrid.appendChild(offerCard);
            });
        }

        // Create offer card element
        function createOfferCard(offer) {
            const colDiv = document.createElement('div');
            colDiv.className = 'col-lg-4 col-md-6 mb-4';
            
            const validUntil = new Date(offer.validUntil);
            const today = new Date();
            const daysLeft = Math.ceil((validUntil - today) / (1000 * 60 * 60 * 24));
            
            colDiv.innerHTML = `
                <div class="offer-card" data-category="${offer.category}">
                    <div class="offer-image" style="background-image: url('${offer.image}');" role="img" aria-label="${offer.item} from ${offer.shopName}">
                        <div class="discount-badge">${offer.discount}% OFF</div>
                    </div>
                    <div class="offer-content">
                        <div class="shop-name">${offer.shopName}</div>
                        <div class="offer-title">${offer.item}</div>
                        
                        <div class="price-section">
                            <span class="original-price">₹${offer.originalPrice}</span>
                            <span class="discounted-price">₹${offer.discountedPrice}</span>
                        </div>
                        
                        <div class="offer-details mb-2">
                            <div class="mb-1">
                                <i class="fas fa-map-marker-alt" aria-hidden="true"></i>
                                <span>${offer.address}</span>
                            </div>
                            <div class="mb-1">
                                <i class="fas fa-phone" aria-hidden="true"></i>
                                <span>${offer.phone}</span>
                            </div>
                            <div class="mb-1">
                                <i class="fas fa-clock" aria-hidden="true"></i>
                                <span>Valid for ${daysLeft > 0 ? daysLeft + ' days' : 'Expires today!'}</span>
                            </div>
                            <div class="mb-2">
                                <i class="fas fa-star text-warning" aria-hidden="true"></i>
                                <span>${offer.rating.toFixed(1)} (${offer.reviews} reviews)</span>
                            </div>
                        </div>
                        
                        <p class="text-muted mb-3 text-muted-small">${offer.description}</p>
                        
                        <button class="directions-btn" onclick="getDirections('${offer.shopName}', '${offer.address}')" aria-label="Get directions to ${offer.shopName}">
                            <i class="fas fa-directions" aria-hidden="true"></i> Get Directions
                        </button>
                    </div>
                </div>
            `;
            
            return colDiv;
        }

        // Update pagination controls
        function updatePagination() {
            const totalPages = Math.ceil(filteredOffers.length / offersPerPage);
            
            // Update button states
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages || totalPages === 0;
            
            // Generate page numbers
            paginationNumbers.innerHTML = '';
            
            if (totalPages <= 1) {
                return;
            }
            
            // Always show first page
            addPageNumber(1);
            
            // Show ellipsis if needed
            if (currentPage > 3) {
                const ellipsis = document.createElement('span');
                ellipsis.className = 'page-dots';
                ellipsis.textContent = '...';
                paginationNumbers.appendChild(ellipsis);
            }
            
            // Show pages around current page
            const startPage = Math.max(2, currentPage - 1);
            const endPage = Math.min(totalPages - 1, currentPage + 1);
            
            for (let i = startPage; i <= endPage; i++) {
                addPageNumber(i);
            }
            
            // Show ellipsis if needed
            if (currentPage < totalPages - 2) {
                const ellipsis = document.createElement('span');
                ellipsis.className = 'page-dots';
                ellipsis.textContent = '...';
                paginationNumbers.appendChild(ellipsis);
            }
            
            // Always show last page if there is more than one page
            if (totalPages > 1) {
                addPageNumber(totalPages);
            }
        }

        // Add page number to pagination
        function addPageNumber(pageNumber) {
            const pageBtn = document.createElement('button');
            pageBtn.className = 'page-number';
            if (pageNumber === currentPage) {
                pageBtn.classList.add('active');
            }
            pageBtn.textContent = pageNumber;
            pageBtn.addEventListener('click', () => {
                currentPage = pageNumber;
                displayOffers();
                updatePagination();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
            paginationNumbers.appendChild(pageBtn);
        }

        // Initialize event listeners
        function initializeEventListeners() {
            // Previous button
            prevBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    displayOffers();
                    updatePagination();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            });

            // Next button
            nextBtn.addEventListener('click', () => {
                const totalPages = Math.ceil(filteredOffers.length / offersPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    displayOffers();
                    updatePagination();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            });

            // City filter
            if (cityFilter) {
                cityFilter.addEventListener('change', function() {
                    currentCity = this.value;
                    applyFilters();
                });
            }

            // Sort filter
            if (sortFilter) {
                sortFilter.addEventListener('change', function() {
                    currentSort = this.value;
                    applyFilters();
                });
            }

            // Search functionality
            if (searchBtn && offerSearch) {
                searchBtn.addEventListener('click', performSearch);
                offerSearch.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performSearch();
                    }
                });
                
                // Real-time search with debouncing
                offerSearch.addEventListener('input', function() {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        if (this.value.length > 0) {
                            performSearch();
                        } else {
                            // If search is cleared, show all offers
                            applyFilters();
                        }
                    }, 500);
                });
            }

            // Category filters
            const filterBtns = document.querySelectorAll('.filter-btn');
            filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    filterBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    currentCategory = this.dataset.category;
                    applyFilters();
                });
            });
        }

        // Apply all filters
        function applyFilters() {
            showLoading();
            
            setTimeout(() => {
                let filtered = [...allOffers];
                
                // Apply category filter
                if (currentCategory !== 'all') {
                    filtered = filtered.filter(offer => offer.category === currentCategory);
                }
                
                // Apply search filter
                const searchTerm = offerSearch.value.toLowerCase().trim();
                if (searchTerm) {
                    filtered = filtered.filter(offer => 
                        offer.shopName.toLowerCase().includes(searchTerm) ||
                        offer.item.toLowerCase().includes(searchTerm) ||
                        offer.description.toLowerCase().includes(searchTerm)
                    );
                }
                
                // Apply city filter
                if (currentCity) {
                    // For demo purposes, we'll filter by address containing city name
                    filtered = filtered.filter(offer => 
                        offer.address.toLowerCase().includes(currentCity)
                    );
                }
                
                // Apply sorting
                if (currentSort) {
                    switch (currentSort) {
                        case 'popular':
                            filtered.sort((a, b) => b.reviews - a.reviews);
                            break;
                        case 'discount':
                            filtered.sort((a, b) => b.discount - a.discount);
                            break;
                        case 'distance':
                            // For demo, we'll sort by rating as a proxy for distance
                            filtered.sort((a, b) => b.rating - a.rating);
                            break;
                        default:
                            // Default: sort by latest (by ID as proxy)
                            filtered.sort((a, b) => b.id - a.id);
                    }
                }
                
                filteredOffers = filtered;
                currentPage = 1;
                displayOffers();
                updatePagination();
                
                if (filtered.length === 0) {
                    showToast('No offers match your filters', 'info');
                } else {
                    showToast(`Found ${filtered.length} offers`, 'success');
                }
                
                hideLoading();
            }, 500);
        }

        // Perform search
        function performSearch() {
            applyFilters();
        }

        // Reset all filters
        function resetFilters() {
            // Reset category filter
            const allCategoryBtn = document.querySelector('[data-category="all"]');
            if (allCategoryBtn) {
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                allCategoryBtn.classList.add('active');
                currentCategory = 'all';
            }
            
            // Reset search
            if (offerSearch) {
                offerSearch.value = '';
            }
            
            // Reset city filter
            if (cityFilter) {
                cityFilter.value = 'kalaburagi';
                currentCity = 'kalaburagi';
            }
            
            // Reset sort filter
            if (sortFilter) {
                sortFilter.value = '';
                currentSort = '';
            }
            
            applyFilters();
        }

        // Get directions
        function getDirections(shopName, address) {
            const encodedAddress = encodeURIComponent(address);
            const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodedAddress}`;
            
            showToast(`Opening directions to ${shopName}...`, 'info');
            setTimeout(() => {
                window.open(mapsUrl, '_blank');
            }, 1000);
        }

        // Show/Hide loading
        function showLoading() {
            if (loadingSpinner) loadingSpinner.style.display = 'block';
        }

        function hideLoading() {
            if (loadingSpinner) loadingSpinner.style.display = 'none';
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();
            
            const bgColor = {
                'success': '#10b981',
                'warning': '#f59e0b',
                'danger': '#ef4444',
                'info': '#2563eb'
            }[type] || '#2563eb';

            const icon = {
                'success': 'check-circle',
                'warning': 'exclamation-triangle',
                'danger': 'exclamation-circle',
                'info': 'info-circle'
            }[type] || 'info-circle';

            const toast = document.createElement('div');
            toast.id = toastId;
            toast.className = 'custom-toast';
            toast.style.background = bgColor;
            toast.style.color = 'white';
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fas fa-${icon} me-2" aria-hidden="true"></i>
                    <span>${message}</span>
                </div>
            `;

            toastContainer.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // Check authentication status
        function checkAuthStatus() {
            // This would typically check if user is logged in
            // For demo purposes, we'll assume user is not logged in
        }
    </script>
</body>
</html>